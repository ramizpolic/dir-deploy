apiserver:
  image:
    repository: ghcr.io/agntcy/dir-apiserver
    tag: latest
    pullPolicy: IfNotPresent
    pullSecrets: []
  
  service:
    type: NodePort

  config:
    # listen_address: "0.0.0.0:8888"
    # healthcheck_address: "0.0.0.0:8889"

    # Store settings for the storage backend.
    store:
      # Storage provider to use.
      provider: "oci"

      # OCI-backed store
      oci:
        # Path to a local directory that will be to hold data instead of remote.
        # If this is set to non-empty value, only local store will be used.
        # local_dir: ""

        # Cache directory to use for metadata.
        # cache_dir: ""

        # Registry address to connect to
        registry_address: "dir-appset-dir-zot.dir.svc.cluster.local:5000"
        
        # All data will be stored under this repo.
        # Objects are pushed as tags, manifests, and blobs.
        # repository_name: ""

        # Auth credentials to use.
        auth_config:
          insecure: "true"
          username: "admin"
          password: "admin"

    # Routing settings for the peer-to-peer network.
    routing:
      # Address to use for routing
      # listen_address: "/ipv4/0.0.0.0/tcp/5555"

      # Path to private key file for peer ID.
      # key_path: /tmp/agntcy-dir/node.privkey

      # Nodes to use for bootstrapping of the DHT.
      # We read initial routing tables here and get introduced
      # to the network.
      # bootstrap_peers:
      #   - /ip4/1.1.1.1/tcp/1
      #   - /ip4/1.1.1.1/tcp/2

      # GossipSub configuration for efficient label announcements
      # When enabled, labels are propagated via GossipSub mesh to ALL subscribed peers
      # When disabled, falls back to DHT+Pull mechanism (higher bandwidth, limited reach)
      # Default: true (recommended for production)
      gossipsub:
        enabled: true

    # Sync configuration
    sync:
      # How frequently the scheduler checks for pending syncs
      scheduler_interval: "30s"
      
      # Maximum number of sync workers running concurrently
      worker_count: 1
      
      # Timeout for individual sync operations
      worker_timeout: "10m"
      
      # Registry monitor configuration
      registry_monitor:
        check_interval: "30s"
      
      # Authentication configuration for sync operations
      auth_config:
        username: "user"
        password: "user"

    # Publication configuration
    publication:
      # How frequently the scheduler checks for pending publications
      scheduler_interval: "1h"
      
      # Maximum number of publication workers running concurrently
      worker_count: 1
      
      # Timeout for individual publication operations
      worker_timeout: "30m"

  # SPIRE configuration
  spire:
    enabled: true
    trustDomain: example.org
    federation:
    -
      trustDomain: dir.agntcy.org
      bundleEndpointURL: https://spire.directory.agntcy.org
      bundleEndpointProfile:
        type: https_spiffe
        endpointSPIFFEID: spiffe://dir.agntcy.org/spire/server
      trustDomainBundle: |-
        {
          "keys":[
              {
                "use":"x509-svid",
                "kty":"RSA",
                "n":"4QZMzOebMUKx6ZizUyxX2WZUZ8Qjt1yQWZi2WQwtVFAMjcyvawAXFbck15DYA4ENl906YEfuW6qUZLkfl8AAlg1TBdPN-VRGovfFWb9Jn3bs91ZF73MYAtGEVFeuYMUayoUIAVZojs6CMduletSVySB1oM4agd8nSQ0yVhPC8YOJO42wtpcYJIR7ksM3m1igociW4U9ry7Ic0jMRAbtv7A6Ax-r8beM0Pxa-uU4R5sTiI9WfbEZxXKyz6YWHsKh12QczNKAfB0TbIrouBJEr4yWRqH2SO29PiyNsOmdCy7lpnLDBf4Mglf0b-vyaEjGdLSWr0qoM6UfGVFAMCnwUjQ",
                "e":"AQAB",
                "x5c":[
                    "MIIDvTCCAqWgAwIBAgIQE37/YSwYRF6lZ6xiaIRYQjANBgkqhkiG9w0BAQsFADBoMQ0wCwYDVQQGEwRBUlBBMRAwDgYDVQQKEwdFeGFtcGxlMRQwEgYDVQQDEwtleGFtcGxlLm9yZzEvMC0GA1UEBRMmMjU5MTQ3NDEwMzczMTYxNjI0NDQ2MDk0MjY0NzE4MjQ2NzY5MzAwHhcNMjUwOTI0MDk0NTM2WhcNMjUwOTI1MDk0NTQ2WjBoMQ0wCwYDVQQGEwRBUlBBMRAwDgYDVQQKEwdFeGFtcGxlMRQwEgYDVQQDEwtleGFtcGxlLm9yZzEvMC0GA1UEBRMmMjU5MTQ3NDEwMzczMTYxNjI0NDQ2MDk0MjY0NzE4MjQ2NzY5MzAwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDhBkzM55sxQrHpmLNTLFfZZlRnxCO3XJBZmLZZDC1UUAyNzK9rABcVtyTXkNgDgQ2X3TpgR+5bqpRkuR+XwACWDVMF0835VEai98VZv0mfduz3VkXvcxgC0YRUV65gxRrKhQgBVmiOzoIx26V61JXJIHWgzhqB3ydJDTJWE8Lxg4k7jbC2lxgkhHuSwzebWKChyJbhT2vLshzSMxEBu2/sDoDH6vxt4zQ/Fr65ThHmxOIj1Z9sRnFcrLPphYewqHXZBzM0oB8HRNsiui4EkSvjJZGofZI7b0+LI2w6Z0LLuWmcsMF/gyCV/Rv6/JoSMZ0tJavSqgzpR8ZUUAwKfBSNAgMBAAGjYzBhMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBStX3Yt5SrYqG5GHO1P76tXxXLOAjAfBgNVHREEGDAWhhRzcGlmZmU6Ly9kaXIuZXhhbXBsZTANBgkqhkiG9w0BAQsFAAOCAQEAd2CkRFP81k+QMN87eirJS4XVYrNYhJ+xWdJ530MUjtHJ6qRyKrpMAdjKwBfS/4xOnjPX4gv5lbv/H02+ySSj23aKRWk3sk4Hv3aiG/8ATVR4bmhcnfywENi7ceW9gYNmYrCkm7gUkW2mKUF6ociyDb41bq4xahuBQhOn/VuwlQlhX8yqz1X2DEtPr1VPMmoCmUQJZMPh+jxkAJCwDNrI1VoS6sjT9/mDrmcJKNx1TtwqT1q9BuU3oLVlPXm/Q38u/m+0M2lF6qaWj3KpwISl11kYMupIqjNC+YSjJeEnbKHs0QTvvNQPvpDukwFSX8GNYTmJlTbs3OnRi7ERrtb3ew=="
                ]
              },
              {
                "use":"jwt-svid",
                "kty":"RSA",
                "kid":"2n2ma4Bn7ZanPVraUBGSzUlgXyZDYsAc",
                "n":"yCf6euCVWweSuGRwoYqC04noin0TaHSfi__3Lmm8iC3Kyuwowq7rVY7I3M5TWj6GcDZsR1WtuKQWxuIXgV7hosd2sMv-IJnnpwks28bonDvmHcgytewfEJcdEaqLIAH0kTes91zLpOs7X7nlsvTl9SD2x6d7XD73lKPcAmhTFO5FNFl0G1q-v0lmeYF0HRs4xYnl_ZYH8C5PocIphkHCEzhEYed7DZdkAWIXTHQQVpGvjBxF9Zgro8Etv9GtDlTAgM_63PPZLeSNc9nXrXb747bJrYXftxdCOXhvOyaty8ZHa22KycyY2A1UFVuwheEdwtXotr-s8lQaodmXWgZFlw",
                "e":"AQAB"
              }
          ]
        }

  # Extra volume mounts for the apiserver container
  extraVolumeMounts: 
  - name: zot-config-storage
    mountPath: /etc/zot

  # Extra volumes - shared between apiserver and zot for config hot reload
  extraVolumes: 
  - name: zot-config-storage
    hostPath:
      path: /opt/zot-config
      type: DirectoryOrCreate

  # Zot registry configuration (subchart)
  zot:
    authHeader: "admin:admin"
    extraVolumeMounts: []
    extraVolumes: []
    
    # Configure zot to use the config file from the shared mounted volume
    # extraArgs:
    #   - "serve"
    #   - "/etc/zot/config.json"

    # ZOT secrets
    mountSecret: true
    secretFiles:
      # Example htpasswd with 'admin:admin' & 'user:user' user:pass pairs
      htpasswd: |-
        admin:$2y$05$vmiurPmJvHylk78HHFWuruFFVePlit9rZWGA/FbZfTEmNRneGJtha
        user:$2y$05$L86zqQDfH5y445dcMlwu6uHv.oXFgT6AiJCwpv3ehr7idc0rI3S2G
  
    # Zot config
    mountConfig: true
    configFiles:
      config.json: |-
        {
          "distSpecVersion": "1.1.1",
          "storage": {
            "rootDirectory": "/var/lib/registry"
          },
          "http": {
            "address": "0.0.0.0",
            "port": "5000",
            "auth": {
              "htpasswd": {
                "path": "/secret/htpasswd"
              }
            },
            "accessControl": {
              "adminPolicy": {
                  "users": ["admin"],
                  "actions": ["read", "create", "update", "delete"]
              },
              "repositories": {
                "**": {
                  "anonymousPolicy": [],
                  "defaultPolicy": ["read"]
                }
              }
            }
          },
          "log": {
            "level": "info"
          },
          "extensions": {
            "search": {
              "enable": true
            },
            "trust": {
              "enable": true,
              "cosign": true,
              "notation": false
            }
          }
        }
